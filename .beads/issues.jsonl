{"id":"thelab-rc-08j","title":"Install and configure Longhorn","description":"Install Longhorn via Helm on single-node k3s. Configure to use /var/lib/longhorn on CM4. Replication increases when RK1 nodes join.","status":"open","priority":3,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.075885-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.555803-07:00","dependencies":[{"issue_id":"thelab-rc-08j","depends_on_id":"thelab-rc-7tf","type":"blocks","created_at":"2026-02-15T22:06:53.41793-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-2nq","title":"Phase 7: Renovate for Updates","description":"Add renovate.json to infra repo, configure to track nixpkgs input in flake.nix. Renovate opens PRs on nixpkgs updates for review.","status":"open","priority":3,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:48.39092-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:02:48.39092-07:00"}
{"id":"thelab-rc-37z","title":"Set up Renovate","description":"Add renovate.json to thelab-infra repo. Configure to track nixpkgs input in flake.nix. Renovate opens PRs on updates.","status":"open","priority":3,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.098648-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.098648-07:00","dependencies":[{"issue_id":"thelab-rc-37z","depends_on_id":"thelab-rc-sug","type":"blocks","created_at":"2026-02-15T22:06:53.414542-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-3fi","title":"Phase 6: Longhorn Storage","description":"Mount NVMe on RK1 nodes and SATA SSD on CM4 via NixOS fileSystems. Install Longhorn via Helm. All 3 nodes contribute storage, replication factor \u003e= 2.","status":"open","priority":3,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:46.682586-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:02:46.682586-07:00"}
{"id":"thelab-rc-3in","title":"Phase 4: Custom Pre-baked Image","description":"Write images/base.nix, build RK1 and CM4 pre-baked images via nixos-generators. Eliminates UART for Nodes 2 \u0026 3 — flash, power on, colmena apply.","status":"open","priority":2,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:43.798297-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:02:43.798297-07:00"}
{"id":"thelab-rc-57r","title":"Write hosts/tp-node3.nix","description":"k3s server with clusterInit=true, disable traefik. Single node for now. RK1 host configs deferred.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.09707-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.568051-07:00","dependencies":[{"issue_id":"thelab-rc-57r","depends_on_id":"thelab-rc-vgy","type":"blocks","created_at":"2026-02-15T22:06:53.415238-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-5m9","title":"Phase 1: Workstation Prep","description":"Enable nix-darwin linux-builder for aarch64-linux cross-compilation, create thelab-infra repo with flake structure, and generate age key for sops-nix secrets.","status":"open","priority":1,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:34.256224-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:02:34.256224-07:00"}
{"id":"thelab-rc-7g0","title":"Generate age key for sops-nix","description":"Run age-keygen to create ~/.config/sops/age/keys.txt. Save public key for .sops.yaml.","status":"open","priority":1,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.077671-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.077671-07:00"}
{"id":"thelab-rc-7s0","title":"Create and wire secrets","description":"sops edit secrets/secrets.yaml, add k3s_token. Reference sops.secrets.k3s_token in each node config with tokenFile.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.091847-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.091847-07:00","dependencies":[{"issue_id":"thelab-rc-7s0","depends_on_id":"thelab-rc-a1e","type":"blocks","created_at":"2026-02-15T22:06:53.423167-07:00","created_by":"Jonathan Park"},{"issue_id":"thelab-rc-7s0","depends_on_id":"thelab-rc-57r","type":"blocks","created_at":"2026-02-15T22:06:53.444687-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-7tf","title":"Mount SATA SSD on CM4","description":"Add NixOS fileSystems entry for SATA SSD on CM4 node. Bind-mount to /var/lib/longhorn.","status":"open","priority":3,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.107445-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.560617-07:00","dependencies":[{"issue_id":"thelab-rc-7tf","depends_on_id":"thelab-rc-9pz","type":"blocks","created_at":"2026-02-15T22:06:53.42908-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-9pz","title":"Build and flash pre-baked CM4 image","description":"nix build cm4-image via nixos-generators using linux-builder. For future CM4 nodes — flash via BMC, SSH ready on boot, colmena apply.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.124754-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.565768-07:00","dependencies":[{"issue_id":"thelab-rc-9pz","depends_on_id":"thelab-rc-csf","type":"blocks","created_at":"2026-02-15T22:06:53.42068-07:00","created_by":"Jonathan Park"},{"issue_id":"thelab-rc-9pz","depends_on_id":"thelab-rc-sug","type":"blocks","created_at":"2026-02-15T22:06:53.438276-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-a1e","title":"Configure .sops.yaml","description":"Define age keys (admin + node3). Set creation_rules for secrets/secrets.yaml. Generate node3 age key on the node. Add RK1 node keys later.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.08863-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.568794-07:00","dependencies":[{"issue_id":"thelab-rc-a1e","depends_on_id":"thelab-rc-7g0","type":"blocks","created_at":"2026-02-15T22:06:53.417783-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-avt","title":"Write hardware/cm4.nix","description":"CM4 boot/filesystem config: rpi4 kernel, extlinux bootloader, SATA SSD filesystem. RK1 hardware config deferred.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.07393-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.552055-07:00","dependencies":[{"issue_id":"thelab-rc-avt","depends_on_id":"thelab-rc-lxn","type":"blocks","created_at":"2026-02-15T22:06:53.416983-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-csf","title":"Write images/base.nix","description":"Minimal bootstrap image: deploy user with SSH key, sudo, openssh enabled, DHCP. Just enough to accept colmena deploy.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.094673-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.094673-07:00","dependencies":[{"issue_id":"thelab-rc-csf","depends_on_id":"thelab-rc-avt","type":"blocks","created_at":"2026-02-15T22:06:53.420054-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-de5","title":"RK1 NPU support not ready for NixOS + k3s","description":"## Summary\n\nThe RK3588 NPU (6 TOPS) on the Turing RK1 has real homelab use cases (Frigate NVR, Immich photo management, local LLM inference), but is currently blocked for our NixOS + k3s stack due to multiple independent issues.\n\n## Research Findings\n\n### What the NPU can do today (on Ubuntu/Docker)\n\n- **Frigate** — Real-time object detection on security camera feeds (~10ms inference, 3 NPU cores). The #1 homelab NPU use case.\n- **Immich** — Self-hosted photo management with NPU-accelerated face recognition and smart search.\n- **rknn-llm** — Small language model inference on-device.\n- **RKNN Model Zoo** — 30+ pre-trained models (YOLO11, SAM, Whisper, CLIP, pose detection, license plates, etc).\n\nAll of these work well today in Docker on Ubuntu/Armbian using Rockchip's proprietary RKNN-Toolkit2 stack.\n\n### Three independent blockers for our stack\n\n#### 1. No RKNN packages in nixpkgs (NixOS gap)\nThe proprietary RKNN runtime ships as precompiled ARM binaries and Python wheels for Ubuntu/Debian. Nobody has packaged it for NixOS. Would require custom packaging of rknn-toolkit2, rknn-toolkit-lite2, and the rknpu2 kernel module.\n\n#### 2. Vendor kernel required (NixOS conflict)\nThe proprietary RKNN driver requires Rockchip's vendor kernel (5.10 or 6.1 BSP). This conflicts with NixOS's mainline kernel approach. Running a vendor kernel on NixOS is possible but painful — you lose nixpkgs kernel module ecosystem.\n\n#### 3. NPU fails in non-privileged k8s containers (upstream issue)\nEven on Ubuntu, the NPU falls back to CPU in standard Kubernetes containers. Only works with privileged: true or plain Docker. See: https://github.com/immich-app/immich/issues/25057\nThis affects any distro running k8s, not just NixOS.\n\n### GPU status (not relevant)\nThe Mali G610 GPU is irrelevant for headless k3s. No CUDA/ROCm, OpenCL (Rusticl) is experimental. Excellent open-source drivers (Vulkan 1.2, OpenGL ES 3.1 via Panthor/PanVK) but no practical headless compute use case.\n\n## Options\n\n### Option A: Wait for open-source Rocket driver (6-12 months)\nA fully open-source, reverse-engineered NPU driver called \"Rocket\" was merged into Linux 6.18 and Mesa 25.3. Once stable, it will be in mainline nixpkgs with no vendor kernel needed. Currently only handles simple models (MobileNet-class). No YOLOv8 or complex architectures yet. Monitor: https://blog.tomeuvizoso.net\n\n### Option B: Run Frigate/Immich on Ubuntu+Docker outside k3s\nRun NPU workloads on one RK1 node using Ubuntu + Docker (not k3s). Keeps NixOS + k3s for everything else. Mixed OS cluster. Simplest path to working NPU today.\n\n### Option C: Package RKNN stack for NixOS + privileged containers\nPackage the proprietary RKNN runtime for NixOS, pin to vendor kernel, run NPU containers as privileged in k3s. High effort, fragile, security trade-off.\n\n### Option D: Defer entirely\nIgnore the NPU for now. Use RK1 nodes as plain ARM compute for k3s. Revisit when Rocket driver matures or the k8s device plugin issue is resolved.\n\n## Recommendation\n\nOption D (defer) for now. The NPU is a nice-to-have, not a requirement for the cluster. Revisit after Linux 6.18+ is in nixpkgs stable and Rocket driver supports YOLO-class models. Track upstream:\n- Rocket driver: https://blog.tomeuvizoso.net\n- k8s NPU passthrough: https://github.com/immich-app/immich/issues/25057\n\n## Sources\n\n- https://github.com/ryan4yin/nixos-rk3588 (archived June 2025)\n- https://github.com/gnull/nixos-rk3588 (active fork)\n- https://github.com/ryan4yin/nixos-rk3588/issues/18 (Turing RK1 support attempt)\n- https://github.com/rockchip-linux/rknn-toolkit2\n- https://github.com/airockchip/rknn-llm\n- https://github.com/immich-app/immich/issues/25057 (k8s NPU issue)\n- https://blog.tomeuvizoso.net/2025/07/rockchip-npu-update-6-we-are-in-mainline.html\n- https://www.phoronix.com/news/Rocket-Rockchip-NPU-Driver\n- https://www.collabora.com/news-and-blog/news-and-events/rockchip-rk3588-upstream-support-progress-future-plans.html\n- https://docs.frigate.video/configuration/object_detectors/\n- https://hackaday.com/2024/12/09/finally-putting-the-rk1-through-its-paces/","status":"open","priority":3,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-16T11:30:23.083152-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T11:30:23.083152-07:00","labels":["research"]}
{"id":"thelab-rc-gtp","title":"Phase 3: Flake + Colmena Setup","description":"Write flake.nix (nixpkgs, sops-nix, nixos-rk3588, nixos-generators), common.nix, hardware configs (rk1.nix, cm4.nix), host-specific configs for 3 nodes (all k3s servers), and hive.nix for Colmena.","status":"open","priority":2,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:40.648039-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:02:40.648039-07:00"}
{"id":"thelab-rc-ihs","title":"Phase 2: Bootstrap CM4 (slot 3)","description":"Flash NixOS to CM4 in slot 3 via BMC, configure via UART, verify SSH access. RK1 nodes deferred.","status":"open","priority":1,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:38.263011-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.564182-07:00"}
{"id":"thelab-rc-jlr","title":"Phase 5: sops-nix Secrets","description":"Configure .sops.yaml with age keys (admin + 3 nodes), create encrypted secrets.yaml with k3s token, wire sops secrets into node configs.","status":"open","priority":2,"issue_type":"epic","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:02:44.445115-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:02:44.445115-07:00"}
{"id":"thelab-rc-lch","title":"Enable nix-darwin linux-builder","description":"Add nix.linux-builder config to nix-darwin (systems = aarch64-linux). Rebuild darwin config. Verify aarch64-linux builds work.","status":"closed","priority":1,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.075634-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T08:53:26.325742-07:00","closed_at":"2026-02-16T08:53:26.325742-07:00","close_reason":"Closed"}
{"id":"thelab-rc-lvb","title":"Flash NixOS image to CM4 slot 3","description":"Download NixOS AArch64 SD image from Hydra (24.11 stable). Decompress and flash via BMC web UI to Node 3. Wait ~35 minutes.","status":"open","priority":1,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.09437-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.54067-07:00","dependencies":[{"issue_id":"thelab-rc-lvb","depends_on_id":"thelab-rc-lch","type":"blocks","created_at":"2026-02-15T22:06:53.402086-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-lxn","title":"Create repos (thelab-rc, thelab-infra, thelab-gitops)","description":"Rename this repo to thelab-rc-docs. Create thelab-rc-infra (NixOS configs, Colmena, secrets, hardware, images) and thelab-rc-gitops (k8s manifests, Helm charts, app deployments). Initialize with directory structure.","status":"closed","priority":1,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.118176-07:00","created_by":"Jonathan Park","updated_at":"2026-02-17T16:40:45.213118-07:00","closed_at":"2026-02-17T16:40:45.213118-07:00","close_reason":"All 3 repos created and pushed to GitHub. thelab-rc (docs, existing), thelab-infra (public, has tpi-cli skill), thelab-gitops (public, empty)."}
{"id":"thelab-rc-mhu","title":"Configure CM4 Node 3 via UART","description":"SSH to BMC, power on Node 3, inject SSH key and create deploy user via UART commands. Run nixos-rebuild switch.","status":"open","priority":1,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.105532-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.548259-07:00","dependencies":[{"issue_id":"thelab-rc-mhu","depends_on_id":"thelab-rc-lvb","type":"blocks","created_at":"2026-02-15T22:06:53.406476-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-pg6","title":"Write hive.nix for Colmena","description":"Define Colmena hive with defaults (deploy user, k3s-server tag), per-node deployment targets with rk1/cm4 tags, imports.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.097081-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.097081-07:00","dependencies":[{"issue_id":"thelab-rc-pg6","depends_on_id":"thelab-rc-57r","type":"blocks","created_at":"2026-02-15T22:06:53.42185-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-sug","title":"First colmena deploy to Node 3","description":"Run colmena apply --on tp-node3. Verify NixOS config applied successfully over SSH.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.086424-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.560736-07:00","dependencies":[{"issue_id":"thelab-rc-sug","depends_on_id":"thelab-rc-pg6","type":"blocks","created_at":"2026-02-15T22:06:53.414553-07:00","created_by":"Jonathan Park"},{"issue_id":"thelab-rc-sug","depends_on_id":"thelab-rc-zlo","type":"blocks","created_at":"2026-02-15T22:06:53.426219-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-vgy","title":"Write flake.nix","description":"Define inputs (nixpkgs, sops-nix, nixos-rk3588, nixos-generators). Define nixosConfigurations for tp-node1, tp-node2, tp-node3. Define image packages.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.099401-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.099401-07:00","dependencies":[{"issue_id":"thelab-rc-vgy","depends_on_id":"thelab-rc-lxn","type":"blocks","created_at":"2026-02-15T22:06:53.404062-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-xid","title":"Write hosts/common.nix","description":"Shared config: deploy user with sudo, SSH hardening, firewall (22, 6443, 2379, 2380, kubelet), base packages, DHCP, flakes enabled.","status":"open","priority":2,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.102554-07:00","created_by":"Jonathan Park","updated_at":"2026-02-15T22:05:53.102554-07:00","dependencies":[{"issue_id":"thelab-rc-xid","depends_on_id":"thelab-rc-lxn","type":"blocks","created_at":"2026-02-15T22:06:53.415179-07:00","created_by":"Jonathan Park"}]}
{"id":"thelab-rc-zlo","title":"Verify SSH access to Node 3","description":"SSH into Node 3 directly, run nixos-version, confirm no more UART needed.","status":"open","priority":1,"issue_type":"task","owner":"accounts@jonpark.dev","created_at":"2026-02-15T22:05:53.102144-07:00","created_by":"Jonathan Park","updated_at":"2026-02-16T15:36:06.541692-07:00","dependencies":[{"issue_id":"thelab-rc-zlo","depends_on_id":"thelab-rc-mhu","type":"blocks","created_at":"2026-02-15T22:06:53.398103-07:00","created_by":"Jonathan Park"}]}
